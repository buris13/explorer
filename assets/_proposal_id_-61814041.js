import{d as it,j as w,I as rt,Z as ut,a2 as ct,Y as dt,m as _t,ag as vt,a1 as d,a8 as mt,o as _,n as v,p as e,t as o,L as $,q as i,M as T,H as k,F as H,s as Y,ah as pt,y as ht,Q as D,K as bt}from"./index-a2808e21.js";import{b as ft,W as gt}from"./index-6e4cb9fd.js";import{_ as G}from"./Countdown.vue_vue_type_style_index_0_lang-2e718954.js";import{_ as yt}from"./PaginationBar.vue_vue_type_script_setup_true_lang-931e257f.js";import"./index-66b2371d.js";const xt={class:"bg-base-100 px-4 pt-3 pb-4 rounded mb-4 shadow"},St={class:"card-title flex flex-col md:!justify-between md:!flex-row mb-2"},wt={class:"truncate w-full"},Tt={class:""},Ot={key:0},Pt={class:"gap-4 mb-4 grid lg:!!grid-cols-3 auto-rows-max"},Nt={class:"bg-base-100 px-4 pt-3 pb-4 rounded shadow"},$t={class:"card-title mb-1"},kt={class:"block text-sm mb-1"},Dt={class:"h-5 w-full relative"},Et={class:"absolute inset-x-0 inset-y-0 text-center text-sm text-[#666] dark:text-[#eee] flex items-center justify-center"},At={class:"mt-6 grid grid-cols-2"},It={class:"bg-base-100 px-4 pt-3 pb-5 rounded shadow lg:!!col-span-2"},Vt={class:"card-title"},Lt={class:"px-1"},Rt={class:"flex items-center mb-4 mt-2"},Bt=e("div",{class:"w-2 h-2 rounded-full bg-error mr-3"},null,-1),Ct={class:"text-base flex-1 text-main"},Ut={class:"text-sm"},jt={class:"flex items-center mb-4"},Wt=e("div",{class:"w-2 h-2 rounded-full bg-primary mr-3"},null,-1),qt={class:"text-base flex-1 text-main"},zt={class:"text-sm"},Ft={class:"mb-4"},Ht={class:"flex items-center"},Yt=e("div",{class:"w-2 h-2 rounded-full bg-yes mr-3"},null,-1),Gt={class:"text-base flex-1 text-main"},Jt={class:"text-sm"},Kt={class:"pl-5 text-sm mt-2"},Mt={class:"flex items-center mb-1"},Qt=e("div",{class:"w-2 h-2 rounded-full bg-success mr-3"},null,-1),Zt={class:"text-base flex-1 text-main"},Xt={class:"text-sm"},te={class:"pl-5 text-sm"},ee={key:0,class:"mt-4"},se={class:"flex items-center"},ae=e("div",{class:"w-2 h-2 rounded-full bg-warning mr-3"},null,-1),oe={class:"text-base flex-1 text-main"},ne={key:0},le={key:1},ie={class:"text-sm"},re={class:"pl-5 text-sm mt-2"},ue={class:"bg-base-100 px-4 pt-3 pb-4 rounded mb-4 shadow"},ce={class:"card-title"},de={class:"overflow-x-auto"},_e={class:"table w-full table-zebra"},ve={class:"py-2 text-sm"},me={key:1,class:"py-2 text-sm"},ye=it({__name:"[proposal_id]",props:["proposal_id","chain"],setup(O){const b=O,s=w({}),r=rt(),f=ut(),R=ct(),B=dt(),J=_t();f.fetchProposal(b.proposal_id).then(t=>{var l,c,p;const a=vt(t.proposal);((l=t.proposal)==null?void 0:l.status)==="PROPOSAL_STATUS_VOTING_PERIOD"&&f.fetchTally(b.proposal_id).then(u=>{a.final_tally_result=u==null?void 0:u.tally}),s.value=a,(c=a.content)!=null&&c.changes&&((p=a.content)==null||p.changes.forEach(u=>{J.rpc.getParams(u.subspace,u.key).then(h=>{s.value.content&&h.param&&(s.value.content.current?s.value.content.current.push(h.param):s.value.content.current=[h.param])})}))});const C=d(()=>s.value.status==="PROPOSAL_STATUS_PASSED"?"success":s.value.status==="PROPOSAL_STATUS_REJECTED"?"error":""),K=d(()=>s.value.status?s.value.status.replace("PROPOSAL_STATUS_",""):""),M=w({});f.fetchProposalDeposits(b.proposal_id).then(t=>M.value=t);const E=w({}),A=w(new mt),I=w({});f.fetchProposalVotes(b.proposal_id).then(t=>{E.value=t.votes,I.value=t.pagination});function g(t){return t?r.toDay(t,"from"):""}const Q=d(()=>{const t=new Date;return new Date(s.value.voting_end_time).getTime()-t.getTime()}),Z=d(()=>{var c,p,u,h,y,x,S;const t=Number(((p=(c=s.value.content)==null?void 0:c.plan)==null?void 0:p.height)||0);if(t>0){const P=bt(),N=Number(((y=(h=(u=P.latest)==null?void 0:u.block)==null?void 0:h.header)==null?void 0:y.height)||0);return(t-N)*6*1e3}const a=new Date;return new Date(((S=(x=s.value.content)==null?void 0:x.plan)==null?void 0:S.time)||"").getTime()-a.getTime()}),m=d(()=>{const t=s.value.final_tally_result;let a=0;return t&&(a+=Number(t.abstain||0),a+=Number(t.yes||0),a+=Number(t.no||0),a+=Number(t.no_with_veto||0)),a}),X=d(()=>{var t;if(m.value>0){const a=((t=B.pool)==null?void 0:t.bonded_tokens)||"1";return r.percent(m.value/Number(a))}return 0}),tt=d(()=>{var t,a;if(m.value>0){const l=((a=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:a.yes)||0;return r.percent(Number(l)/m.value)}return 0}),et=d(()=>{var t,a;if(m.value>0){const l=((a=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:a.no)||0;return r.percent(Number(l)/m.value)}return 0}),st=d(()=>{var t,a;if(m.value>0){const l=((a=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:a.no_with_veto)||0;return r.percent(Number(l)/m.value)}return 0}),at=d(()=>{var t,a;if(m.value>0){const l=((a=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:a.abstain)||0;return r.percent(Number(l)/m.value)}return 0}),ot=d(()=>[{name:"Turnout",value:X.value,class:"bg-info"},{name:"Yes",value:tt.value,class:"bg-success"},{name:"No",value:et.value,class:"bg-error"},{name:"No With Veto",value:st.value,class:"bg-red-800"},{name:"Abstain",value:at.value,class:"bg-warning"}]);function nt(t){const{data:a}=D.fromBech32(t),l=D.toHex(a),c=B.validators.find(p=>D.toHex(D.fromBech32(p.operator_address).data)===l);return c?c.description.moniker:t}function lt(t){A.value.setPage(t),f.fetchProposalVotes(b.proposal_id,A.value).then(a=>{E.value=a.votes,I.value=a.pagination})}function V(t){return t?JSON.parse(t):{}}return(t,a)=>{var l,c,p,u,h,y,x,S,P,N,U,j,W,q,z;return _(),v("div",null,[e("div",xt,[e("h2",St,[e("p",wt,o(O.proposal_id)+". "+o(s.value.title||((l=s.value.content)==null?void 0:l.title)||((p=V((c=s.value)==null?void 0:c.metadata))==null?void 0:p.title)),1),e("div",{class:$(["badge badge-ghost",i(C)==="success"?"text-yes":i(C)==="error"?"text-no":"text-info"])},o(i(K)),3)]),e("div",Tt,[T(ft,{value:s.value.content},null,8,["value"])]),s.value.summary&&!((u=s.value.content)!=null&&u.description)||(y=V((h=s.value)==null?void 0:h.metadata))!=null&&y.summary?(_(),v("div",Ot,[T(i(gt),{"model-value":i(r).multiLine(s.value.summary||((S=V((x=s.value)==null?void 0:x.metadata))==null?void 0:S.summary)),previewOnly:"",class:"md-editor-recover"},null,8,["model-value"])])):k("",!0)]),e("div",Pt,[e("div",Nt,[e("h2",$t,o(t.$t("gov.tally")),1),(_(!0),v(H,null,Y(i(ot),(n,L)=>(_(),v("div",{class:"mb-1",key:L},[e("label",kt,o(n.name),1),e("div",Dt,[e("div",{class:$(["absolute inset-x-0 inset-y-0 w-full opacity-10 rounded-sm",`${n.class}`])},null,2),e("div",{class:$(["absolute inset-x-0 inset-y-0 rounded-sm",`${n.class}`]),style:pt(`width: ${n.value==="-"||n.value==="NaN%"?"0%":n.value}`)},null,6),e("p",Et,o(n.value),1)])]))),128)),e("div",At,[e("label",{for:"vote",class:"btn btn-primary float-right btn-sm mx-1",onClick:a[0]||(a[0]=n=>i(R).open("vote",{proposal_id:O.proposal_id}))},o(t.$t("gov.btn_vote")),1),e("label",{for:"deposit",class:"btn btn-primary float-right btn-sm mx-1",onClick:a[1]||(a[1]=n=>i(R).open("deposit",{proposal_id:O.proposal_id}))},o(t.$t("gov.btn_deposit")),1)])]),e("div",It,[e("h2",Vt,o(t.$t("gov.timeline")),1),e("div",Lt,[e("div",Rt,[Bt,e("div",Ct,o(t.$t("gov.submit_at"))+": "+o(i(r).toDay(s.value.submit_time)),1),e("div",Ut,o(g(s.value.submit_time)),1)]),e("div",jt,[Wt,e("div",qt,o(t.$t("gov.deposited_at"))+": "+o(i(r).toDay(s.value.status==="PROPOSAL_STATUS_DEPOSIT_PERIOD"?s.value.deposit_end_time:s.value.voting_start_time)),1),e("div",zt,o(g(s.value.status==="PROPOSAL_STATUS_DEPOSIT_PERIOD"?s.value.deposit_end_time:s.value.voting_start_time)),1)]),e("div",Ft,[e("div",Ht,[Yt,e("div",Gt,o(t.$t("gov.vote_start_from"))+" "+o(i(r).toDay(s.value.voting_start_time)),1),e("div",Jt,o(g(s.value.voting_start_time)),1)]),e("div",Kt,[T(G,{time:i(Q)},null,8,["time"])])]),e("div",null,[e("div",Mt,[Qt,e("div",Zt,o(t.$t("gov.vote_end"))+" "+o(i(r).toDay(s.value.voting_end_time)),1),e("div",Xt,o(g(s.value.voting_end_time)),1)]),e("div",te,o(t.$t("gov.current_status"))+": "+o(t.$t(`gov.proposal_statuses.${s.value.status}`)),1)]),(U=(N=(P=s.value)==null?void 0:P.content)==null?void 0:N["@type"])!=null&&U.endsWith("SoftwareUpgradeProposal")?(_(),v("div",ee,[e("div",se,[ae,e("div",oe,[ht(o(t.$t("gov.upgrade_plan"))+": ",1),Number(((W=(j=s.value.content)==null?void 0:j.plan)==null?void 0:W.height)||"0")>0?(_(),v("span",ne," (EST)")):(_(),v("span",le,o(i(r).toDay((z=(q=s.value.content)==null?void 0:q.plan)==null?void 0:z.time)),1))]),e("div",ie,o(g(s.value.voting_end_time)),1)]),e("div",re,[T(G,{time:i(Z)},null,8,["time"])])])):k("",!0)])])]),e("div",ue,[e("h2",ce,o(t.$t("gov.votes")),1),e("div",de,[e("table",_e,[e("tbody",null,[(_(!0),v(H,null,Y(E.value,(n,L)=>(_(),v("tr",{key:L},[e("td",ve,o(nt(n.voter)),1),n.option?(_(),v("td",{key:0,class:$(["py-2 text-sm",{"text-yes":n.option==="VOTE_OPTION_YES","text-gray-400":n.option==="VOTE_OPTION_ABSTAIN"}])},o(String(n.option).replace("VOTE_OPTION_","")),3)):k("",!0),n.options?(_(),v("td",me,o(n.options.map(F=>`${F.option.replace("VOTE_OPTION_","")}:${i(r).percent(F.weight)}`).join(", ")),1)):k("",!0)]))),128))])]),T(yt,{limit:A.value.limit,total:I.value.total,callback:lt},null,8,["limit","total"])])])])}}});export{ye as default};
