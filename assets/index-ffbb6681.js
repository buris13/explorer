import{d as X,Y as Z,K as tt,I as et,a2 as st,m as at,$ as ot,j as v,l as nt,a1 as F,r as it,o as p,n as g,p as t,M as b,q as r,S as x,t as o,al as rt,L as m,F as lt,s as ct,y as k,f as dt,O as ut}from"./index-434f4538.js";import{b as R}from"./route-block-83d24a4e.js";const ht={class:"bg-base-100 rounded-lg grid sm:grid-cols-1 md:grid-cols-4 p-4"},pt={class:"flex"},_t={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},vt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-success"},null,-1),gt={class:"font-bold"},mt={class:"text-xs"},ft={class:"flex"},bt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},xt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-primary"},null,-1),yt={class:"font-bold"},kt={class:"text-xs"},wt={class:"flex"},$t={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},St=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-error"},null,-1),Ct={class:"font-bold"},jt={class:"text-xs"},Nt={class:"flex"},It={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},zt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-error"},null,-1),Lt={class:"font-bold"},Bt={class:"text-xs"},Et={class:"flex items-center justify-between py-1"},Pt={class:"tabs tabs-boxed bg-transparent"},Vt={class:"text-lg font-semibold"},Ot={class:"bg-base-100 px-4 pt-3 pb-4 rounded shadow"},At={class:"overflow-x-auto"},Ft={class:"table staking-table w-full"},Rt={scope:"col",class:"uppercase",style:{width:"3rem",position:"relative"}},Tt={scope:"col",class:"uppercase"},Jt={scope:"col",class:"text-right uppercase"},Mt={scope:"col",class:"text-right uppercase"},Dt={scope:"col",class:"text-right uppercase"},Wt={scope:"col",class:"text-center uppercase"},qt={class:"flex items-center overflow-hidden",style:{"max-width":"300px"}},Ht={class:"avatar mr-4 relative w-8 h-8 rounded-full"},Kt=t("div",{class:"w-8 h-8 rounded-full bg-gray-400 absolute opacity-10"},null,-1),Ut={class:"w-8 h-8 rounded-full"},Yt=["src","onError"],Gt={class:"flex flex-col"},Qt={class:"text-sm text-primary dark:invert whitespace-nowrap overflow-hidden"},Xt={class:"text-xs"},Zt={class:"text-right"},te={class:"flex flex-col"},ee={class:"text-sm font-weight-medium whitespace-nowrap"},se={class:"text-xs"},ae={class:"text-right text-xs"},oe={class:"text-center"},ne={key:0,class:"badge badge-error gap-2 text-white"},ie=["onClick"],re=t("div",{class:"divider"},null,-1),le={class:"flex flex-row items-center"},ce={class:"text-xs truncate relative py-2 px-4 rounded-md w-fit text-error mr-2"},de=t("span",{class:"inset-x-0 inset-y-0 opacity-10 absolute bg-error"},null,-1),ue={class:"text-xs truncate relative py-2 px-4 rounded-md w-fit text-warning"},he=t("span",{class:"inset-x-0 inset-y-0 opacity-10 absolute bg-warning"},null,-1),pe={class:"text-xs hidden md:!block pl-2"},_e=X({__name:"index",setup(ve){const l=Z(),w=tt(),h=et(),T=st(),j=at(),J=ot(),M=JSON.parse(localStorage.getItem("avatars")||"{}"),_=v(M||{}),$=v({}),N=v({}),d=v("active"),f=v([]),S=v({});nt(()=>{l.fetchUnbondingValdiators().then(e=>{f.value=e.concat(f.value)}),l.fetchInacitveValdiators().then(e=>{f.value=f.value.concat(e)}),j.rpc.getSlashingParams().then(e=>{S.value=e.params})});async function D(){var i,n,a;let e=0,s=Number(((a=(n=(i=w.latest)==null?void 0:i.block)==null?void 0:n.header)==null?void 0:a.height)||0);for(s>14400?s-=14400:s=1;e<l.validators.length&&s>0;)await w.fetchValidatorByHeight(s,e).then(c=>{c.validators.forEach(u=>{N.value[u.pub_key.key]=Number(u.voting_power)})}),e+=100;for(e=0;e<l.validators.length;)await w.fetchLatestValidators(e).then(c=>{c.validators.forEach(u=>{$.value[u.pub_key.key]=Number(u.voting_power)})}),e+=100}const W=F(()=>{const e={};return Object.keys($.value).forEach(s=>{const i=$.value[s]||0,n=N.value[s]||0;e[s]=i-n}),e}),I=e=>{const s=e.key;return W.value[s]},q=e=>{if(!e)return"";const s=I(e);return s&&s!==0?h.showChanges(s):""},H=e=>{if(!e)return"";const s=I(e);if(s>0)return"text-success";if(s<0)return"text-error"},K=function(e){var n;let s=0;for(let a=0;a<e;a++)s+=Number((n=l.validators[a])==null?void 0:n.delegator_shares);const i=s/l.totalPower;switch(!0){case(d.value==="active"&&i<.33):return"error";case(d.value==="active"&&i<.67):return"warning";default:return"primary"}};function U(e,s){return!e||!s?!1:e.findIndex(i=>{var n,a,c;return s.website&&((a=s.website)==null?void 0:a.substring(0,(n=s.website)==null?void 0:n.lastIndexOf(".")).endsWith(i))||((c=s==null?void 0:s.moniker)==null?void 0:c.toLowerCase().search(i.toLowerCase()))>-1})>-1}const z=F(()=>{var e,s,i;if(d.value==="active")return l.validators.map((n,a)=>({v:n,rank:K(a),logo:C(n.description.identity)}));if(d.value==="featured"){const n=(i=(s=(e=j.current)==null?void 0:e.endpoints)==null?void 0:s.rest)==null?void 0:i.map(a=>a.provider);return n?(n.push("ping"),l.validators.filter(a=>U(n,a.description)).map((a,c)=>({v:a,rank:"primary",logo:C(a.description.identity)}))):[]}return f.value.map((n,a)=>({v:n,rank:"primary",logo:C(n.description.identity)}))}),L=e=>new Promise(s=>{l.keybase(e).then(i=>{var n,a,c;if(Array.isArray(i.them)&&i.them.length>0){const u=String((c=(a=(n=i.them[0])==null?void 0:n.pictures)==null?void 0:a.primary)==null?void 0:c.url).replace("https://s3.amazonaws.com/keybase_processed_uploads/","");_.value[e]=u,s()}else throw new Error(`failed to fetch avatar for ${e}`)}).catch(i=>{s()})}),Y=e=>{L(e).then(()=>{localStorage.setItem("avatars",JSON.stringify(_.value))})},G=()=>{const e=l.validators.map(s=>{var n;const i=(n=s.description)==null?void 0:n.identity;return i&&!_.value[i]?L(i):Promise.resolve()});Promise.all(e).then(()=>localStorage.setItem("avatars",JSON.stringify(_.value)))},C=e=>{if(!e||!_.value[e])return"";const s=_.value[e]||"";return s.startsWith("http")?s:`https://s3.amazonaws.com/keybase_processed_uploads/${s}`};return D(),G(),(e,s)=>{var n;const i=it("RouterLink");return p(),g("div",null,[t("div",ht,[t("div",pt,[t("span",null,[t("div",_t,[b(r(x),{class:"text-success",icon:"mdi:trending-up",size:"32"}),vt])]),t("span",null,[t("div",gt,o(r(h).percent(r(J).inflation)),1),t("div",mt,o(e.$t("staking.inflation")),1)])]),t("div",ft,[t("span",null,[t("div",bt,[b(r(x),{class:"text-primary",icon:"mdi:lock-open-outline",size:"32"}),xt])]),t("span",null,[t("div",yt,o(r(rt)((n=r(l).params)==null?void 0:n.unbonding_time)),1),t("div",kt,o(e.$t("staking.unbonding_time")),1)])]),t("div",wt,[t("span",null,[t("div",$t,[b(r(x),{class:"text-error",icon:"mdi:alert-octagon-outline",size:"32"}),St])]),t("span",null,[t("div",Ct,o(r(h).percent(S.value.slash_fraction_double_sign)),1),t("div",jt,o(e.$t("staking.double_sign_slashing")),1)])]),t("div",Nt,[t("span",null,[t("div",It,[b(r(x),{class:"text-error",icon:"mdi:pause",size:"32"}),zt])]),t("span",null,[t("div",Lt,o(r(h).percent(S.value.slash_fraction_downtime)),1),t("div",Bt,o(e.$t("staking.downtime_slashing")),1)])])]),t("div",null,[t("div",Et,[t("div",Pt,[t("a",{class:m(["tab text-gray-400",{"tab-active":d.value==="featured"}]),onClick:s[0]||(s[0]=a=>d.value="featured")},o(e.$t("staking.popular")),3),t("a",{class:m(["tab text-gray-400",{"tab-active":d.value==="active"}]),onClick:s[1]||(s[1]=a=>d.value="active")},o(e.$t("staking.active")),3),t("a",{class:m(["tab text-gray-400",{"tab-active":d.value==="inactive"}]),onClick:s[2]||(s[2]=a=>d.value="inactive")},o(e.$t("staking.inactive")),3)]),t("div",Vt,o(r(z).length)+"/"+o(r(l).params.max_validators),1)]),t("div",Ot,[t("div",At,[t("table",Ft,[t("thead",null,[t("tr",null,[t("th",Rt,o(e.$t("staking.rank")),1),t("th",Tt,o(e.$t("staking.validator")),1),t("th",Jt,o(e.$t("staking.voting_power")),1),t("th",Mt,o(e.$t("staking.24h_changes")),1),t("th",Dt,o(e.$t("staking.commission")),1),t("th",Wt,o(e.$t("staking.actions")),1)])]),t("tbody",null,[(p(!0),g(lt,null,ct(r(z),({v:a,rank:c,logo:u},Q)=>{var B,E,P,V;return p(),g("tr",{key:a.operator_address,class:"hover:bg-gray-100 dark:hover:bg-[#384059]"},[t("td",null,[t("div",{class:m(["text-xs truncate relative px-2 py-1 rounded-full w-fit",`text-${c}`])},[t("span",{class:m(["inset-x-0 inset-y-0 opacity-10 absolute",`bg-${c}`])},null,2),k(" "+o(Q+1),1)],2)]),t("td",null,[t("div",qt,[t("div",Ht,[Kt,t("div",Ut,[u?(p(),g("img",{key:0,src:u,class:"object-contain",onError:y=>{var A;const O=(A=a.description)==null?void 0:A.identity;O&&Y(O)}},null,40,Yt)):(p(),dt(r(x),{key:1,class:"text-3xl",icon:"mdi-help-circle-outline"}))])]),t("div",Gt,[t("span",Qt,[b(i,{to:{name:"chain-staking-validator",params:{validator:a.operator_address}},class:"font-weight-medium"},{default:ut(()=>{var y;return[k(o((y=a.description)==null?void 0:y.moniker),1)]}),_:2},1032,["to"])]),t("span",Xt,o(((B=a.description)==null?void 0:B.website)||((E=a.description)==null?void 0:E.identity)||"-"),1)])])]),t("td",Zt,[t("div",te,[t("h6",ee,o(r(h).formatToken({amount:parseInt(a.tokens).toString(),denom:r(l).params.bond_denom},!0,"0,0")),1),t("span",se,o(r(h).calculatePercent(a.delegator_shares,r(l).totalPower)),1)])]),t("td",{class:m(["text-right text-xs",H(a.consensus_pubkey)])},o(q(a.consensus_pubkey)),3),t("td",ae,o(r(h).formatCommissionRate((V=(P=a.commission)==null?void 0:P.commission_rates)==null?void 0:V.rate)),1),t("td",oe,[a.jailed?(p(),g("div",ne,o(e.$t("staking.jailed")),1)):(p(),g("label",{key:1,for:"delegate",class:"btn btn-xs btn-primary rounded-sm capitalize",onClick:y=>r(T).open("delegate",{validator_address:a.operator_address})},o(e.$t("account.btn_delegate")),9,ie))])])}),128))])])]),re,t("div",le,[t("div",ce,[de,k(" "+o(e.$t("staking.top"))+" 33% ",1)]),t("div",ue,[he,k(" "+o(e.$t("staking.top"))+" 67% ",1)]),t("div",pe,o(e.$t("staking.description")),1)])])])])}}});typeof R=="function"&&R(_e);export{_e as default};
